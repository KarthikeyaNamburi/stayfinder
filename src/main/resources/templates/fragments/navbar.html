<nav th:fragment="navbar" class="bg-white shadow">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
        <a class="text-2xl font-semibold text-primary" href="/">StayFinder</a>

        <!-- Mobile: toggle -->
        <div class="md:hidden" x-data="{ open: false }">
            <button @click="open = !open" :aria-expanded="open.toString()" class="text-gray-700 focus:outline-none p-2 rounded-md" aria-label="Toggle menu">
                <svg x-show="!open" x-cloak xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
                <svg x-show="open" x-cloak xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>

            <div x-show="open" x-cloak x-transition class="mt-2 space-y-2 bg-white rounded-md p-2 shadow-sm">
                <a href="/search" class="block px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Search Homestays</a>
                <a href="/login" sec:authorize="!isAuthenticated()" class="block px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Login</a>
                <a href="/register" sec:authorize="!isAuthenticated()" class="block px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">Register</a>
                <a href="/bookings" sec:authorize="isAuthenticated()" class="block px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100">My Bookings</a>
                <span sec:authorize="isAuthenticated()" class="block px-3 py-2 text-gray-700">Welcome, <span sec:authentication="name"></span></span>
                <form th:action="@{/logout}" method="post" class="px-3 py-2" sec:authorize="isAuthenticated()">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" th:if="${_csrf != null}" />
                    <button type="submit" class="text-left text-gray-700 hover:text-gray-900">Logout</button>
                </form>
            </div>
        </div>

        <!-- Desktop -->
        <div class="hidden md:flex md:items-center md:space-x-4">
            <nav class="flex items-center space-x-4">
                <a href="/search" class="text-gray-700 hover:text-gray-900">Search</a>
                <a href="/bookings" sec:authorize="isAuthenticated()" class="text-gray-700 hover:text-gray-900">My Bookings</a>
            </nav>

            <div class="flex items-center space-x-4">
                <a href="/login" sec:authorize="!isAuthenticated()" class="text-gray-700 hover:text-gray-900">Login</a>
                <a href="/register" sec:authorize="!isAuthenticated()" class="text-gray-700 hover:text-gray-900">Register</a>

                <div sec:authorize="isAuthenticated()" class="flex items-center space-x-3">
                    <span class="text-gray-700">Welcome, <span sec:authentication="name"></span></span>
                    <form th:action="@{/logout}" method="post" class="inline">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" th:if="${_csrf != null}" />
                        <button type="submit" class="text-gray-700 hover:text-gray-900 ml-2">Logout</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</nav>