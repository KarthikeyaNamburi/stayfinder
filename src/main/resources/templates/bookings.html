<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head('My Bookings - StayFinder')}"></head>
<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <section class="max-w-6xl mx-auto px-6 py-12">
        <header class="mb-6">
            <h1 class="text-2xl font-bold text-gray-900">My Bookings</h1>
            <p class="text-sm text-gray-600">Manage your bookings and view details.</p>
        </header>

        <!-- Success / confirmation banners -->
        <div th:if="${success != null}" class="mb-4">
            <div th:switch="${success}">
                <div th:case="'demo'" class="rounded-lg bg-green-50 border border-green-200 p-4 text-green-700">
                    Demo booking created and added to My Bookings (no payment required for demo).
                </div>
                <div th:case="'booked'" class="rounded-lg bg-green-50 border border-green-200 p-4 text-green-700">
                    Booking created successfully.
                </div>
                <div th:case="* " class="rounded-lg bg-blue-50 border border-blue-200 p-4 text-blue-700">
                    Action completed.
                </div>
            </div>
        </div>

        <div th:if="${bookings == null or #lists.isEmpty(bookings)}" class="space-y-4">
            <div th:if="${demoMode}">
                <div class="rounded-lg bg-blue-50 border border-blue-200 p-4 text-blue-700">
                    Showing demo bookings for demo user. Sign in to see your real bookings.
                </div>

                <!-- Render a few static sample bookings so the page looks populated in demo mode -->
                <div class="space-y-4 mt-4">
                    <!-- Sample booking 1 -->
                    <div class="bg-white rounded-2xl shadow p-4">
                        <div class="flex items-start gap-4">
                            <a href="/homestays/1" class="w-40 h-28 block flex-shrink-0 rounded-md overflow-hidden">
                                <img src="/images/placeholder.svg" alt="Homestay Image" class="w-full h-full object-cover" />
                            </a>

                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900">Visakhapatnam</h3>
                                <p class="text-sm text-gray-600 mt-1 line-clamp-2">Sea-view cottage with friendly host and local breakfast.</p>

                                <div class="mt-3 flex items-center justify-between">
                                    <div class="text-sm text-gray-700">
                                        <div><strong>Dates:</strong> 2025-10-01 - 2025-10-02</div>
                                        <div class="mt-1"><strong>Status:</strong> CONFIRMED</div>
                                    </div>

                                    <div class="text-right">
                                        <div class="text-sm text-gray-700"><strong>Price: ₹</strong>1800</div>
                                        <a href="/homestays/1" class="inline-block bg-primary text-white px-4 py-2 rounded-lg text-sm mt-2 hover:opacity-95">View Homestay</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sample booking 2 -->
                    <div class="bg-white rounded-2xl shadow p-4">
                        <div class="flex items-start gap-4">
                            <a href="/homestays/2" class="w-40 h-28 block flex-shrink-0 rounded-md overflow-hidden">
                                <img src="/images/placeholder.svg" alt="Homestay Image" class="w-full h-full object-cover" />
                            </a>

                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900">Vijayawada</h3>
                                <p class="text-sm text-gray-600 mt-1 line-clamp-2">Traditional Andhra home close to market and transport.</p>

                                <div class="mt-3 flex items-center justify-between">
                                    <div class="text-sm text-gray-700">
                                        <div><strong>Dates:</strong> 2025-10-05 - 2025-10-06</div>
                                        <div class="mt-1"><strong>Status:</strong> PENDING</div>
                                    </div>

                                    <div class="text-right">
                                        <div class="text-sm text-gray-700"><strong>Price: ₹</strong>1200</div>
                                        <a href="/homestays/2" class="inline-block bg-primary text-white px-4 py-2 rounded-lg text-sm mt-2 hover:opacity-95">View Homestay</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sample booking 3 -->
                    <div class="bg-white rounded-2xl shadow p-4">
                        <div class="flex items-start gap-4">
                            <a href="/homestays/3" class="w-40 h-28 block flex-shrink-0 rounded-md overflow-hidden">
                                <img src="/images/placeholder.svg" alt="Homestay Image" class="w-full h-full object-cover" />
                            </a>

                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900">Guntur</h3>
                                <p class="text-sm text-gray-600 mt-1 line-clamp-2">Cozy family stay with garden and local cuisine.</p>

                                <div class="mt-3 flex items-center justify-between">
                                    <div class="text-sm text-gray-700">
                                        <div><strong>Dates:</strong> 2025-10-10 - 2025-10-11</div>
                                        <div class="mt-1"><strong>Status:</strong> CONFIRMED</div>
                                    </div>

                                    <div class="text-right">
                                        <div class="text-sm text-gray-700"><strong>Price: ₹</strong>1000</div>
                                        <a href="/homestays/3" class="inline-block bg-primary text-white px-4 py-2 rounded-lg text-sm mt-2 hover:opacity-95">View Homestay</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${!demoMode}" class="rounded-lg bg-yellow-50 border border-yellow-200 p-4 text-yellow-700">
                You have no bookings yet. Search and book a homestay to see it here.
            </div>
        </div>

        <div th:if="${bookings != null and !#lists.isEmpty(bookings)}" class="space-y-4 mt-6">
            <div th:each="booking : ${bookings}" class="bg-white rounded-2xl shadow p-4">
                <div class="flex items-start gap-4">
                    <a th:href="@{/homestays/{id}(id=${booking.homestay.id})}" class="w-40 h-28 block flex-shrink-0 rounded-md overflow-hidden">
                        <img th:src="@{'/images/' + booking.homestay.id + '.jpg'}" alt="Homestay Image" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='/images/placeholder.svg';" />
                    </a>

                    <div class="flex-1">
                        <h3 class="text-lg font-semibold text-gray-900" th:text="${booking.homestay.location}">Location</h3>
                        <p class="text-sm text-gray-600 mt-1 line-clamp-2" th:text="${booking.homestay.description != null ? booking.homestay.description : 'No description available.'}">Description</p>

                        <div class="mt-3 flex items-center justify-between">
                            <div class="text-sm text-gray-700">
                                <div><strong>Dates:</strong> <span th:text="${booking.checkInDate}">2025-10-01</span> - <span th:text="${booking.checkOutDate}">2025-10-02</span></div>
                                <div class="mt-1"><strong>Status:</strong> <span th:text="${booking.status}">PENDING</span></div>
                            </div>

                            <div class="text-right">
                                <div class="text-sm text-gray-700"><strong>Price: ₹</strong><span th:text="${booking.homestay.price}">1200</span></div>
                                <a th:href="@{/homestays/{id}(id=${booking.homestay.id})}" class="inline-block bg-primary text-white px-4 py-2 rounded-lg text-sm mt-2 hover:opacity-95">View Homestay</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6">
            <a href="/search" class="text-sm text-gray-700 hover:underline">Back to Search</a>
        </div>
    </section>

</body>
</html>